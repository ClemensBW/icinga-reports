<project name="Icinga-Reports" basedir=".." default="package">

	<!-- project-specific variables -->
	<property name="package.name" value="icinga-reports.war" />
	<property name="resources.dir" value="resources" />

	<!-- src folders -->
	<property name="src.dir" value="src" />
	<property name="src.webcontent" value="WebContent" />
	<property name="meta-inf.dir" value="${src.webcontent}/META-INF" />
	<property name="web-inf.dir" value="${src.webcontent}/WEB-INF" />
	<property name="lib.dir" value="${web-inf.dir}/lib" />

	<!-- temp folders -->
	<property name="temp.dir" value="temp" />
	<property name="temp.dir.web-inf" value="${temp.dir}/WEB-INF" />
	<property name="temp.dir.lib" value="${temp.dir.web-inf}/lib" />
	<property name="temp.dir.classes" value="${temp.dir.web-inf}/classes" />
	<property name="temp.dir.meta-inf" value="${temp.dir}/META-INF" />

	<!-- packing -->
	<property name="dest.dir" value="build" />
	<property name="package.file" value="${dest.dir}/${package.name}" />

	<path id="build.class.path">
		<fileset dir="WebContent/WEB-INF/lib">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="WebContent/WEB-INF/lib">
			<include name="**/*.jar" />
		</fileset>
	</path>

	<!-- CLEAN -->
	<target name="clean">
		<delete file="${dest.dir}/${package.name}" />
		<delete dir="${temp.dir}" />
		<delete dir="${temp.dir.classes}" />
		<delete dir="${temp.dir.meta-inf}" />
		<delete dir="${temp.dir.web-inf}" />
	</target>

	<!-- PREPARE -->
	<target name="prepare" depends="clean">
		<mkdir dir="${dest.dir}" />
		<mkdir dir="${temp.dir}" />
		<mkdir dir="${temp.dir.lib}" />
		<mkdir dir="${temp.dir.meta-inf}" />
		<mkdir dir="${temp.dir.web-inf}" />
		<mkdir dir="${temp.dir.classes}" />
	</target>

	<!-- COMPILE -->
	<target name="compile" depends="prepare">
		<echo>=== COMPILE ===</echo>
		<echo>Compiling ${src.dir} files ...</echo>
		<javac debug="on" srcdir="${src.dir}" destdir="${temp.dir.classes}" includes="**/*">
			<classpath refid="build.class.path" />
			<classpath path="/Users/berk/Documents/Apache-Tomcat/lib/servlet-api.jar" />
		</javac>
	</target>

	<!-- PACKAGE -->
	<target name="package" depends="compile">
		<echo>=== PACKAGE ===</echo>

		<!-- copy the config files -->
		<copy file="${meta-inf.dir}/MANIFEST.MF" tofile="${temp.dir.meta-inf}/MANIFEST.MF" overwrite="true" />
		<copy file="${meta-inf.dir}/context.xml" tofile="${temp.dir.meta-inf}/context.xml" overwrite="true" />
		<copy file="${web-inf.dir}/web.xml" tofile="${temp.dir.web-inf}/web.xml" overwrite="true" />

		<!-- the ant war task. with all resources in place, create the war file -->
		<war destfile="${package.file}" webxml="${temp.dir.web-inf}/web.xml" basedir="${temp.dir}">
			<lib dir="${lib.dir}" />
		</war>
	</target>

</project>